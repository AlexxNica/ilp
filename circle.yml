machine:
  node:
    version: 5.11.1
test:
  override:
    # Run tests with coverage
    - npm test --coverage
  post:
    # Upload code coverage data
    - bash <(curl -s https://codecov.io/bash) || echo "Codecov did not collect coverage reports"
deployment:
  production:
    branch: master
    commands:
      # Publish spec
      # - git config --global user.email "info@circleci.com"
      # - git config --global user.name "CircleCI"
      # - git config --global push.default simple
      # - node scripts/publish_web.js
      # Push NPM package if not yet published
      - mv npmrc-env .npmrc
      - if [ $(npm show ilp version) != $(cat package.json | grep version | sed -n -e 's/^.*"version": "\([0-9]*.[0-9]*.[0-9]*\).*/\1/p') ] ; then npm publish ; fi
general:
  artifacts:
    - "coverage/lcov-report"
